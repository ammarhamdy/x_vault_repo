
https://www.wireshark.org/docs/man-pages/tshark.html.

# General

To start a capture in TShark, simply execute the command `tshark`.
```
tshark
```

To start a capture in tcpdump, execute the command `tcpdump`.
```
tcpdump
```


## Select specific interfaces

You can list the interfaces available to TShark by using the –D argument.
```
tshark -D
```
To use a specific interface, use the –i argument with the interface’s assigned number from the interface list:
```
tshark –i 1
```

Specifying the interface is also done by using the –i argument:
```
tcpdump –i eth0
```


## Write the output on file

```
tshark –i 1 –w packets.pcap
```

```
tcpdump –i eth0 –w packets.pcap
```


## To read packets back from a saved file

```
tshark –r packets.pcap
```

```
tcpdump –r packets.pcap
```


## Limit the number of packets
You can limit the number of packets displayed when reading from a file by using the –c argument.

The following command will show only the first 10 packets

```
tshark –r packets.pcap –c10
```

```
tcpdump –r packets.pcap –c10
```


The –c argument can also be used at capture time.
Executing this command will capture only the first 10 packets that are observed. 
They can also be saved when –c is combined with the –w argument.

```
tshark –i 1 –w packets.pcap –c10
```

```
tcpdump –i eth0 –w packets.pcap –c10
```


# Manipulating Output

`TShark` and `tcpdump` are no different: They both show a single line of output for each packet, requiring you to use additional commands to view information such as protocol details or individual bytes.

TCP packets use this format:
```
[Timestamp] [Layer 3 Protocol] [Source IP].[Source Port] > [Destination IP].[Destination Port]: [TCP Flags], [TCP Sequence Number], [TCP Acknowledgement Number], [TCP Windows Size], [Data Length]
```

While UDP packets use this format:
```
[Timestamp] [Layer 3 Protocol] [Source IP].[Source Port] > [Destination IP].[Destination Port]: [Layer 4 Protocol], [Data Length]
```


The simplest way to gain more information about each packet is to
increase the verbosity of the output.
In `TShark`, a capital V is used to [increase verbosity](https://translate.google.com/?sl=en&tl=ar&text=increase%20verbosity&op=translate):

```
tshark –r packets.pcap –V
```

In `tcpdump`, the lowercase v is used to increase verbosity. 
Unlike `TShark`, `tcpdump` allows multiple levels of verbosity to be displayed for
each packet.
```
tcpdump –r packets.pcap –vvv
```
The levels of verbosity available will depend on the protocol of the packet you’re examining.


# Name Resolution

Like `Wireshark`, `TShark` and `tcpdump` will attempt to perform name resolution to convert addresses and port numbers to names.
You may have noticed that this occurs by default.
You can disable name resolution in TShark by using the –n argument.

```
tshark –ni 1
```

You can enable or disable certain aspects of name resolution with the –N argument. 
If you use the –N argument, all name resolution will be disabled except for any you explicitly enable using the appropriate values.

For instance, the following command will enable only transport layer
```
tshark –i 1 –Nt
```

This command will enable transport layer and MAC resolution
```
tshark –i 1 -Ntm
```
The following values are available when using this option:
`m` - MAC address resolution
`n` - Network address resolution
`t` - Transport layer (port name) resolution
`N` - Use external resolvers
`C` - Concurrent DNS lookups

In `tcpdump`, using –n will disable IP name resolution, and using –nn will disable port name resolution as well.

```
tcpdump –nni eth1
```


# Applying Filters

Filtering in `TShark` and `tcpdump` is very flexible because both allow the use of `BPF` capture filters. 
`TShark` can also use Wireshark display filters.

Capture filters can be applied using the –f argument, followed by the BPF syntax you wish to use in quotation marks.

```
tshark –ni 1 –w packets.pcap –f "tcp port 80"
```

Display filters can be applied using the –Y argument, followed by the Wireshark filter syntax you wish to use in quotation marks. 
This can be applied at capture time like this:
```
tshark –ni 1 –w packets.pcap –Y "tcp.dstport == 80"
```

With `tcpdump`, you specify filters inline at the end of a command within single quotes.
```
tcpdump –nni eth0 –w packets.pcap 'tcp dst port 80'
```

You can specify a filter when reading packets as well.
```
tcpdump –r packets.pcap 'tcp dst port 80'
```

What if you have a capture file that contains a large variety of packets, but you want to filter out a subset of them and save that subset to a separate file? You can do this by combining the –w and –r arguments:
```
tcpdump –r packets.pcap 'tcp dst port 80' –w http_packets.pcap
```

In addition to specifying a filter inline, `tcpdump` allows you to reference a BPF file containing a series of filters.
You can specify a filter file using the –F argument, like this:
```
tcpdump –nni eth0 –F dns_servers.bpf
```


# Time Display Formats in TShark

One thing that often confuses new analysts is the default timestamp used by `TShark`.
It shows packet timestamps in relation to the start of the packet capture. 
There are times when such timestamping is preferable, but in many cases you may want to see the time the packet was captured, as is the default for `tcpdump` timestamps.

You can get this same output from `TShark` by using the –t argument with the value ad for absolute date:
```
tshark –r packets.pcap –t ad
```

Time Display Formats Available in `TShark`

| Value | Timestamp Example                              |
|-------|-----------------------------------------------|
| a     | Absolute time the packet was captured (in your time zone): 15:47:58.004669 |
| ad    | Absolute time the packet was captured with date (in your time zone): 2015-10-09 15:47:58.004669 |
| d     | Delta (time difference) since previous captured packet: 0.000140 |
| dd    | Delta since previous displayed packet: 0.000140 |
| e     | Epoch time (seconds since January 1, 1970, UTC): 1444420078.004669 |
| r     | Elapsed time between the first packet and the current packet: 0.000140 |
| u     | Absolute time the packet was captured (UTC): 19:47:58.004669 |
| ud    | Absolute time the packet was captured with date (UTC): 2015-10-09 19:47:58.004669 |


# Summary Statistics in TShark

Another useful `TShark` feature (and one that sets it apart from `tcpdump`) is its ability to generate a subset of statistics from a capture file.

Statistics are generated by using the –z argument and specifying the name of the output you would like to generate. 
You can view a full listing of available statistics by using this command:
```
tshark –z help
```

They include the ability to output endpoint and conversation statistics using this command:
```
tshark -r packets.pcap –z conv,ip
```
This command prints a table of statistics with information about the IP conversations in the file `packets.pcap`

you can use the `http`,tree option to see a breakdown of HTTP requests and responses in table form.
```
tshark -r packets.pcap –z http,tree
```


# Comparing TShark and tcpdump
Both command line packet analysis applications we’ve examined in this chapter are well suited to their respective tasks, and either of them will allow you to accomplish whatever task is at hand with varying degrees ofeffort. 
There are a few differences worth highlighting so you can choose the best tool for the job:

**Operating system**
+ `tcpdump` is only available for Unix-based operating systems, while `TShark` can function on Windows and Unix-based systems.


**Protocol support** 
+ Both tools support common layer 3 and 4 protocols, but `tcpdump` has limited layer 7 protocol support. 
+ `TShark` provides a rich level of layer 7 protocol support because it has access to Wireshark’s protocol dissectors.

**Analysis features** 
+ Both tools rely heavily on human analysis to produce meaningful results, but `TShark` also provides a robust set of analytical and statistical features, similar to those in Wireshark, that can aid analysis when a GUI isn’t available.

