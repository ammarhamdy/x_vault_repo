

# Generating a List of Consecutive IP Addresses

Using a for loop to create a list of IP addresses with the seq command
```sh
#!/bin/bash
# generate IP addresses from a given range
for ip in $(seq 1 254); do
	echo "172.16.10.${ip}" >> 172-16-10-hosts.txt
done
```

Generating a list of IP addresses with `echo` and `sed`
```sh
echo 10.1.0.{1..254} | sed 's/ /\n/g'
```

Generating a list of IP addresses with `printf`
```sh
printf "10.1.0.%d\n" {1..254}
```


# Host Discovery

## Pinging multiple hosts using a while loop
```sh
#!/bin/bash
FILE="${1}"

while read -r host; do
	if ping -c 1 -W 1 -w 1 "${host}" &> /dev/null; then
		echo "${host} is up."
	fi
done < "${FILE}"
```

## Extract only the IP addresses that were identified as being alive
```sh
nmap -sn 192.168.1.0/24 | grep "Nmap scan" | awk -F'report for ' '{print $2}'
```
To remove from the output the `_getway ...` and the current device IP use `sed`
```sh
nmap -sn 192.168.1.0/24 | grep "Nmap scan" | awk -F'report for ' '{print $2}' | sed -E 's/_gat.*|ubun.*//g; /^\s*$/d'
```
`-E` -> for extended regex
`; /^\s*$/d` -> start with spaces and end with spaces:
+ `/^` -> start with
+ `\s*` -> any type of spaces
+ `$` -> end with
`/d` -> for delete

## [[arp-scan]]

The `arp-scan` utility sends Address Resolution Protocol (ARP) packets
to hosts on a network and displays any responses it gets back.

ARP maps media access control (MAC) addresses, which are unique 12-digit hexadecimal addresses assigned to network devices, to the IP addresses on a network.

```sh
sudo arp-scan 172.16.10.10 -I wlo1
```

You can use the hosts file:
```sh
sudo arp-scan -f hosts.txt -I wlo1
```


# Port Scanning

## `nmap`

```sh
sudo nmap -sn 192.168.1.0/24 | \
awk '
/Nmap scan report for/ {ip=$NF; host=""; if (NF>5) {host=$5};}
/MAC Address:/ {mac=$3; vendor=substr($0, index($0,$4)); 
    printf "%-15s %-20s %-20s %s\n", ip, mac, vendor, host;
}
' | sort
```

When we provide Nmap with no special options on the command line, it will use the following default settings:

+ Perform a SYN scan Nmap will use a synchronization (SYN) scan to discover open ports on a target. Also called a half-open scan, a SYN scan involves sending a SYN packet and waiting for a response. Nmap won’t complete the full TCP handshake (meaning ACK won’t be sent back), which is why we call this scan half open. 

+ Scan the top 1,000 ports Nmap will scan only popular ports known to be frequently in use, such as TCP ports 21, 22, 80, and 443. It won’t scan the entire port range of 0–65,534, to conserve resources.

+ Scan TCP ports ​Nmap will scan only TCP ports, not User Datagram Protocol (UDP) ports.


# Banner grabbing

Banner grabbing is the process of extracting the information published by remote network services when a connection is established between two parties.

Services often transmit these banners to “greet” clients, which can use the information provided in various ways, such as to ensure they’re connecting to the right target. 

Banners could also include a system admin message of the day or the service’s specific running version.

## Passive banner grabbing

Passive banner grabbing uses third-party websites to look up banner information.
For example, websites such as:
+ `Shodan` (https://shodan​.io)
+ `ZoomEye` (https://zoomeye​.org) 
+ `Censys` (https://censys​.io)
perform scans to map the internet, grabbing banners, versions, website pages, and ports, then create an inventory using this data.

## Active banner grabbing

Active banner grabbing is the opposite; it establishes a connection to
a server and interacts with it directly to receive its banner information.

Keep in mind that banners are generally free-form text fields, and they can be changed to mislead clients. 

For example, an Apache web server could present itself as another type of web server, such as `nginx`. 
Some organizations even create honeypot servers to lure threat actors (or penetration testers).

## Using Active Banner Grabbing

To demonstrate what active banner grabbing looks like, we’ll use the following Netcat command to connect to port 21 (FTP) running on IP address `172.16.10.11`
```sh
nc 172.16.10.11 -v 21
```

## Detecting HTTP Responses

You’ll often find the popular curl HTTP client on production systems. 

To perform banner grabbing on HTTP responses, we can use curl to send an HTTP request using the HEAD method. 

The HEAD method  allows us to read response headers without fetching the entire response payload from the web server.

```sh
curl --head 172.16.10.10:8081
```

## Use nmap

The `banner.nse` script in the `/usr/share/nmap/scripts` folder allows you to grab the banners from many hosts simultaneously. 

The following bash command uses this script to perform a banner grab and service discovery (`-sV`):

```sh
nmap -sV --script=banner.nse -iL 172-16-10-hosts.txt
```