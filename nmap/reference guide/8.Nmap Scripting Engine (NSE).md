
https://nmap.org/book/man-nse.html

---

The Nmap Scripting Engine (`NSE`) is one of Nmap's most powerful and flexible features. 

It allows users to write (and share) simple scripts (using the [Lua programming language](https://lua.org/) ) to automate a wide variety of networking tasks. 

Those scripts are executed in parallel with the speed and efficiency you expect from Nmap. 

Users can rely on the growing and diverse set of scripts distributed with Nmap, or write their own to meet custom needs.

----


Tasks we had in mind when creating the system include network discovery, more sophisticated version detection, vulnerability detection. 

`NSE` can even be used for vulnerability exploitation.

---

To reflect those different uses and to simplify the choice of which scripts to run, each script contains a field associating it with one or more categories. 

Currently defined categories are `auth`, `broadcast`, `default`. `discovery`, `dos`, `exploit`, `external`, `fuzzer`, `intrusive`, `malware`, `safe`, `version`, and `vuln`. 

These are all described in [the section called “Script Categories”](https://nmap.org/book/nse-usage.html#nse-categories "Script Categories").

---

Scripts are not run in a sandbox and thus could accidentally or maliciously damage your system or invade your privacy. 

Never run scripts from third parties unless you trust the authors or have carefully audited the scripts yourself.

---
# Scripts categories

Scripts are organized into **categories** like:

| Category    | Description                                         |
| ----------- | --------------------------------------------------- |
| `auth`      | Authentication-related (e.g., password brute force) |
| `broadcast` | Broadcast network discovery                         |
| `default`   | Run with `-sC` or `--script=default`                |
| `discovery` | Further host information (e.g., SMB shares)         |
| `exploit`   | Known vulnerability exploits                        |
| `intrusive` | Likely to be detected or cause service disruption   |
| `malware`   | Detection of backdoors or malware                   |
| `safe`      | Unlikely to affect target service                   |
| `vuln`      | Check for specific vulnerabilities                  |

To see details about all scripts, you can run:
```sh
nmap --script-help all
```

```sh
nmap --script-help vuln
```

---
# Basic Syntax

```bash
nmap --script=<script-name> <target>
```

```bash
nmap --script=http-title scanme.nmap.org
```

**To run multiple scripts:**
```bash
nmap --script=default,vuln 192.168.1.1
```

**To run all scripts in a category (e.g. `vuln`):**
```bash
nmap --script "vuln"
```

**You can also pass arguments:**
```bash
nmap --script=http-brute --script-args userdb=users.txt,passdb=pass.txt 192.168.1.1
```

**You can list all available scripts using:**
```bash
ls /usr/share/nmap/scripts/
```
**Or search for them with:**
```bash
nmap --script-help <script-name>
```

---

# `-sC`


==Performs a script scan using the default set of scripts.== 

It is equivalent to `--script=default`. 

Some of the scripts in this category are considered intrusive and should not be run against a target network without permission.

Note that this shorthand option is ignored whenever at least one `--script` is also specified.


# `--script <filename>|<category>|<directory>/|<expression>[,...]`

Runs a script scan using the comma-separated list of filenames, script categories, and directories. 

Each element in the list may also be a Boolean expression describing a more complex set of scripts. 

Each element is interpreted first as an expression, then as a category, and finally as a file or directory name.


There are two special features for advanced users only. 

One is to prefix script names and expressions with `+` to force them to run even if they normally wouldn't (e.g. the relevant service wasn't detected on the target port). 

The other is that the argument `all` may be used to specify every script in Nmap's database. 

>Be cautious with this because NSE contains dangerous scripts such as exploits, brute force authentication crackers, and denial of service attacks.


File and directory names may be relative or absolute. 
Absolute names are used directly. 
Relative paths are looked for in the `scripts` of each of the following places until found:
+ `--datadir`
+ `$NMAPDIR`
+ `~/.nmap`
+ `<APPDATA>\nmap`
+ the directory containing the `nmap` executable
+ the directory containing the `nmap` executable, followed by `../share/nmap`
+ `NMAPDATADIR`
+ the current directory.


When a directory name ending in `/` is given, Nmap loads every file in the directory whose name ends with `.nse`. 

All other files are ignored and directories are not searched recursively. 

When a filename is given, it does not have to have the `.nse` extension; it will be added automatically if necessary.

For efficiency, scripts are indexed in a database stored in `scripts/script.db`, which lists the category or categories in which each script belongs.

When referring to scripts from `script.db` by name, you can use a shell-style ‘`*`’ wildcard.
```bash
nmap --script "http-*"
```
+ Loads all scripts whose name starts with `http-`, such as `http-auth` and `http-open-proxy`. 
+ The argument to `--script` had to be in quotes to protect the wildcard from the shell.

```bash
nmap --script "not intrusive"
```
+ Loads every script except for those in the `intrusive` category.

```bash
nmap --script "default or safe"
```
+ This is functionally equivalent to **`nmap --script "default,safe"`**. 
+ It loads all scripts that are in the `default` category ==or== the `safe` category ==or== both.

```bash
nmap --script "default and safe"
```
+ Loads those scripts that are in _==both==_ the `default` and `safe` categories.

```bash
nmap --script "(default or safe or intrusive) and not http-*"
```
+ Loads scripts in the `default`, `safe`, or `intrusive` categories, except for those whose names start with `http-`.

**Operators**

>More complicated script selection can be done using the `and`, `or`, and `not` operators to build Boolean expressions. 

>The operators have the same [precedence](http://www.lua.org/manual/5.4/manual.html#3.4.8) as in Lua: `not` is the highest, followed by `and` and then `or`. 

>You can alter precedence by using parentheses. Because expressions contain space characters it is necessary to quote them.


# `--script-args <n1>=<v1>,<n2>={<n3>=<v3>},<n4>={<v4>,<v5>}`

```bash
nmap --script=http-brute --script-args userdb=users.txt,passdb=pass.txt 192.168.1.1
```

Lets you provide arguments to `NSE` scripts. 

Arguments are a comma-separated list of `name=value` pairs. 

Names and values may be strings not containing whitespace or the characters ‘`{`’, ‘`}`’, ‘`=`’, or ‘`,`’. 

To include one of these characters in a string, enclose the string in single or double quotes. 

Within a quoted string, ‘`\`’ escapes a quote. 

A backslash is only used to escape quotation marks in this special case; in all other cases a backslash is interpreted literally. 

Values may also be tables enclosed in `{}`, just as in Lua. 

A table may contain simple string values or more name-value pairs, including nested tables. 

Many scripts qualify حدد their arguments with the script name, as in `xmpp-info.server_name`. 

You may use that full qualified مؤهَل version to affect just the specified script, or you may pass the unqualified version (`server_name` in this case) to affect all scripts using that argument name. 

A script will first check for its fully qualified argument name (the name specified in its documentation) before it accepts an unqualified argument name. 

A complex example of script arguments is 
```bash
--script-args 'user=foo,pass=",{}=bar",whois={whodb=nofollow+ripe},xmpp-info.server_name=localhost'.
```

The online `NSE` Documentation Portal at [`https://nmap.org/nsedoc/`](https://nmap.org/nsedoc/) lists the arguments that each script accepts.

# `--script-args-file <filename>`

```bash
nmap --script http-enum --script-args-file args.txt 192.168.1.1
```
- `http-enum` --> is the script being run.
- `args.txt` --> contains the arguments for the `http-enum` script.
- `192.168.1.1` --> is the target IP.

Lets you load arguments to `NSE` scripts from a file. 

Any arguments on the command line supersede ones in the file.

The file can be an absolute path, or a path relative to Nmap's usual search path (`NMAPDIR`, etc.) Arguments can be comma-separated or newline-separated, but otherwise follow the same rules as for `--script-args`, without requiring special quoting and escaping, since they are not parsed by the shell.

## Example Use Case

Suppose you’re using the `http-auth` script to test authentication on a web server, and you want to pass a username and password.

Create a file named `auth_args.txt` with:
```bash
http-auth.username=admin
http-auth.password=pass123
```

Run the Nmap command:
```bash
nmap --script http-auth --script-args-file auth_args.txt -p 80 192.168.1.100
```
+ This tells Nmap to use the `http-auth` script with the arguments from `auth_args.txt` to scan port 80 on the target.

## Example in Action

To scan for vulnerabilities using the vuln script with specific arguments.

Create `vuln_args.txt`:
```bash
vuln.timeout=10s
vuln.maxthreads=5
```
Run
```bash
nmap --script vuln --script-args-file vuln_args.txt -p 80,443 192.168.1.10
```


# `--script-help <filename>|<category>|<directory>|<expression>|all[,...]`

Shows help about scripts. 

For each script matching the given specification, Nmap prints the script name, its categories, and its description. 

The specifications are the same as those accepted by `--script`; so for example if you want help about the `ftp-anon` script, you would run **`nmap --script-help ftp-anon`**. 

In addition to getting help for individual scripts, you can use this as a preview of what scripts will be run for a specification, for example with **`nmap --script-help default`**.

**Example**
```bash
nmap --script-help http-enum
```
Output: Displays details about the `http-enum` script, such as:
- Description: Enumerates directories and files on web servers.
- Categories: e.g., discovery, intrusive.
- Arguments: e.g., `http-enum.path`, `http-enum.aggressive`.


# `--script-trace`

This option does what `--packet-trace` does, just one ISO layer higher. 

>If this option is specified all incoming and outgoing communication performed by a script is printed. 

The displayed information includes the communication protocol, the source, the target and the transmitted data. 

If more than 5% of all transmitted data is not printable, then the trace output is in a hex dump format. 

Specifying `--packet-trace` enables script tracing too.


# `--script-updatedb`

This option updates the script database found in `scripts/script.db` which is used by Nmap to determine the available default scripts and categories. 

**Use only if:**
>It is only necessary to update the database if you have added or removed `NSE` scripts from the default `scripts` directory or if you have changed the categories of any script. 

This option is generally used by itself: **`nmap --script-updatedb`**.


----

# `broadcast-avahi-dos`


**Categories:** `broadcast`, `dos`, `intrusive`, `vuln`.

**Key Argument:** `broadcast-avahi-dos`.
+ Wait (default: 20 seconds) specifies the time to wait before re-checking if hosts are still responsive. 
+ Hosts that don’t respond after this period are considered potentially vulnerable.

**References:** The script targets the `Avahi` vulnerability documented at [avahi](http://avahi.org/ticket/325) and [CVE-2011-1002](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-1002).

The `broadcast-avahi-dos` Nmap script is designed to discover hosts on a local network using the DNS Service Discovery (DNS-SD) protocol and ==test if they are vulnerable to the== `Avahi NULL UDP`  packet denial-of-service (DoS) vulnerability (`CVE-2011-1002`).

This script sends a NULL UDP packet to each discovered host and checks if it becomes unresponsive after a specified wait time, indicating potential vulnerability.


```bash
nmap --script broadcast-avahi-dos --script-args broadcast-avahi-dos.wait=10
```

```bash
nmap --script broadcast-avahi-dos --script-args-file args.txt
```

```bash
nmap --script broadcast-avahi-dos --script-args broadcast-avahi-dos.wait=15,max-newtargets=10
```


---

# `smb-vuln-regsvc-dos`

**Purpose**: Tests if a target’s Remote Registry Service is vulnerable to a DoS attack by sending a specially crafted packet.

**Categories**: `vuln`, `dos`, `intrusive`.

**Port**: Typically targets `SMB` ports (`445/tcp`, sometimes `139/tcp)`.

**CVE Reference**: `CVE-2000-0663` (affects older Windows systems like Windows NT/2000).

The `smb-vuln-regsvc-dos` Nmap script checks for a denial-of-service (DoS) vulnerability in the Microsoft Windows Remote Registry Service (`Regsvc`). 

This vulnerability, identified as `CVE-2000-0663`, can potentially crash the service or the system by sending a malformed request. 

The script is categorized as `vuln`, `dos`, and `intrusive`.

```bash
nmap --script smb-vuln-regsvc-dos -p 445 192.168.1.100
```
This scans `192.168.1.100` on port `445` to check if the Remote Registry Service is vulnerable.

**Run with the `vuln` category to test for multiple vulnerabilities, including `smb-vuln-regsvc-dos`:**
```bash
nmap --script vuln -p 445 192.168.1.100
```

