
#### Nmap offers better host detection as it sends more probes than the ICMP echo request sent by the traditional ping utility.


- #### Internet Control Message Protocol (ICMP):
	- The primary purpose of ICMP is for error reporting
	- is a [network layer](https://www.cloudflare.com/learning/network-layer/what-is-the-network-layer/) protocol used by network devices to diagnose network communication issues.
	- ICMP is mainly used to determine whether or not data is reaching its intended destination in a timely manner (في الوقت المناسب).
	- the ICMP protocol is used on network devices, such as routers.
	- ICMP is crucial for error reporting and testing, but it can also be used in [distributed denial-of-service (DDoS) attacks](https://www.cloudflare.com/learning/ddos/what-is-a-ddos-attack/)


- #### finding online host:
	Launch a ping scan against a target to determine whether it is online using this command
	```nmap -sn <target>```
		- "`-sn`" mean  Ping Scan.
		- target could be my current device `ip` address just to test.
		- target could be hostnames, and network ranges that can be defined using wildcards and Classless Inter-Domain Routing (CIDR) notation.
		- "`--traceroute`" option to trace the route from the scanning machine to the target host.
	The results will include all hosts that responded to any of the packets sent by Nmap during  
	the ping scan


- #### example for Classless Inter-Domain Routing CIDR:
	- network ID + host ID / n
	- - n is number of bits that are present in Block Id / Network Id.
	- 192.168.1.1/24 :
		- network ID takes 24 bits and host ID takes 8 bits


- #### details:
	- The Nmap `-sn` option disables port scanning, leaving only the host discovery phase enabled, which makes Nmap perform a ping scan or ping sweep.
	- Nmap by default uses different techniques:
		- sending a TCP SYN packet to port 443.
		- sending a TCP ACK packet to port 80.
		- and an ICMP echo and timestamp requests if executed as a privileged user.
		- If the user running Nmap can't send raw packets, it sends a SYN packet to ports 80 and 443 via connect() syscall.
	- ARP/Neighbor Discovery is also enabled when scanning local Ethernet networks as privileged users


- An interesting NSE script to try when discovering online hosts in networks is the broadcast-ping script, which uses a broadcast-ping request to attempt to discover online hosts.
  `nmap -sn --script broadcast-ping 192.168.1.1/24`

```sh
sudo nmap -sn --script broadcast-ping 192.168.1.1/24 --script-args=newtargets
```
+ `-sn`: **"Ping scan"** — tells Nmap _not_ to do a full port scan, just check which hosts are up (formerly known as `-sP`).
+ `--script broadcast-ping`: Runs a **Nmap NSE script** that sends a broadcast ICMP ping on the network. It asks **all devices to reply**.
+ `--script-args=newtargets`: This tells the script: **any host that responds, add it to the list of targets** so Nmap can scan them further


