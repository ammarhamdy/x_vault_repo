

## Which API Features You Should Test

One of the main goals of scoping an API security engagement is to discover the quantity of work you’ll have to do as part of your test.

As such, you must find out
	**how many unique API endpoints**, 
	**methods**, 
	**versions**, 
	**features**, 
	**authentication** and 
	**authorization mechanisms**, and 
	**privilege levels** you’ll need to test.

The magnitude of the testing can be determined through
interviews with the client, a review of the relevant API documentation, and access to API collections. 

Once you have the requested information, you should be able to gauge how many hours it will take to effectively test the
client’s APIs.


## Web Application Firewalls

In a white box [engagement](https://translate.google.com/?sl=en&tl=ar&text=engagement&op=translate), you will want to be aware of any web application firewalls (WAFs) that may be in use. 

A **WAF** _is a common defense mechanism for web applications and APIs._ 

**A WAF** _is a device that controls the network traffic that reaches the API._ 

If a WAF has been set up properly, you will find out quickly during testing when access to the API is lost after performing a simple scan. 

WAFs can be great at 
	limiting unexpected requests and 
	stopping an API security test in its tracks.

An effective WAF will detect the frequency of requests or request failures and ban your testing device.


In gray box and white box engagements, the client will likely reveal the WAF to you, at which point you will have some decisions to make. 


## Threat modeling

**Threat modeling** in software testing is a proactive approach used to identify, analyze, and mitigate potential security threats to an application or system. 

It helps teams understand the application from an attacker's perspective and design strategies to address vulnerabilities early in the development lifecycle.


### Key Objectives of Threat Modeling

1. **Identify Security Requirements**: 
	+ Understand what security measures are needed based on the system's functionality and purpose.

2. **Understand Potential Threats**: 
	+ Enumerate and analyze threats that could compromise the system's security.

3. **[Assess](https://translate.google.com/?sl=en&tl=ar&text=Assess&op=translate) Vulnerabilities**: 
	+ Pinpoint weaknesses in the system that could be exploited.

4. **Prioritize Risks**: 
	+ Evaluate the likelihood and impact of threats to determine which issues to address first.

5. **Design [Mitigations](https://translate.google.com/?sl=en&tl=ar&text=Mitigations&op=translate)**: 
	+ Plan and implement measures to prevent, detect, or respond to potential threats.


## The best tests of an API will be those that align with actual threats to the API provider. 

To get a test that provides the most value to the security of the API, it is ideal to map out the [probable adversary](https://translate.google.com/?sl=en&tl=ar&text=probable%20adversary&op=translate) and their
hacking techniques. 

Otherwise, you’ll find yourself testing the effectiveness of the API provider’s WAF rather than the effectiveness of their API security controls.


## Mobile Application Testing

Many organizations have mobile applications that expand the attack surface. 

Moreover, mobile apps often rely on APIs to transmit data within the application and to supporting servers.

You can test these APIs through 
	manual code review, 
	automated source code analysis, 
	and dynamic analysis.

**Manual code review** 
	involves accessing the mobile application’s source code and searching for potential vulnerabilities. 

**Automated source code analysis**
	is similar, except it uses automated tools to assist in the search for vulnerabilities and interesting artifacts. 

**Finally, dynamic analysis** 
+ is the testing of the application ==while it is running==. 
+ Dynamic analysis includes intercepting the mobile app’s client API requests and the server API responses and then [attempting to](https://translate.google.com/?sl=en&tl=ar&text=attempting%20to&op=translate) find weaknesses that can be exploited.



## Auditing API Documentation

**An API’s documentation** 
+ is a manual that describes how to use the API and includes
	+ authentication requirements,
	+ user roles, 
	+ usage examples, and 
	+ API endpoint information. 

As an API hacker, you should search for your target’s API documentation and use it to your advantage. 

In gray box and white box testing, an API documentation audit
should be included within the scope.

A review of the documentation will improve the security of the target APIs by exposing weaknesses, including business logic flaws.



## Rate Limit Testing

Rate limiting is a restriction on the number of requests an API consumer can make within a given time frame. 

It is enforced by an API provider’s web servers, firewall, or web application firewall and serves two important purposes for API providers: 
	it allows for the monetization of APIs and 
	prevents the overconsumption of the provider’s resources.
	
Because rate limiting is an essential factor that allows  organizations to monetize their APIs, you should include it in your scope during API engagements.

For example, a business might allow a free-tier API user to make one request per hour.

==Rate limit testing is not the same as denial of service (DoS) testing.==

DoS testing consists of attacks that are intended to [disrupt](https://translate.google.com/?sl=en&tl=ar&text=disrupt&op=translate) services and make the systems and applications unavailable to users. 

Whereas DoS testing is meant to assess how resilient an organization’s computing resources are, ___rate limit testing___ seeks to bypass restrictions that limit the quantity of requests
sent within a given time frame. 

[Attempting to bypass](https://translate.google.com/?sl=en&tl=ar&text=Attempting%20to%20bypass&op=translate) rate limiting will not necessarily cause a disruption to services. 

Instead, bypassing rate limiting could aid in other attacks and demonstrate a weakness in an organization’s method of monetizing its API.


## Twitter as example

Twitter, for example, limits requests based on your authorization once you’re authenticated. 

The first tier can make 15 requests every 15 minutes,
and the next tier can make 180 requests every 15 minutes. 

If you exceed your request limit, you will be sent an HTTP Error 420

If insufficient security controls are in place to limit access to an API, the API provider will lose money from consumers cheating the system, incur additional costs due to the use of additional host resources, ==and find themselves vulnerable to DoS attacks.==


## Restrictions and Exclusions

Unless otherwise specified in penetration testing authorization documentation, you should assume that you ==won’t be performing DoS and distributed DoS (DDoS) attacks. ==

==In my experience, being authorized to do so is pretty
rare.==

In situations where you could perform an attack against a user, programs normally suggest creating multiple accounts and, when the relevant opportunity arises, attacking your own test accounts.



## Security Testing Cloud APIs

Modern web applications are often hosted in the cloud. 

==When you attack a cloud-hosted web application, you’re actually attacking the physical servers of cloud providers (likely Amazon, Google, or Microsoft).==

You should always know the current requirements of the target cloud provider before attacking. 

The following list describes the policies of the most common providers.

**Amazon Web Services (AWS)**  

+ AWS has greatly improved its stance on penetration testing.

+ As of this writing, AWS allows its customers to perform all sorts of security testing, with the exception of DNS zone walking, DoS or DDoS attacks, simulated DoS or DDoS attacks, port flooding, protocol flooding, and request flooding.

+ For any exceptions to this, you must email AWS and request permission to conduct testing.

**Google Cloud Platform (GCP)**

+ Google simply states that you do not need to request permission or notify the company to perform penetration testing. 

+ However, Google also states that you must remain compliant with its ==acceptable use policy== (AUP) and terms of service (TOS) and stay within your authorized scope. 

+ The AUP and TOS prohibit illegal actions, phishing, spam, distributing malicious or destructive files (such as viruses, worms, and Trojan horses), and interruption to GCP services.

**Microsoft Azure**

+ Microsoft takes the hacker-friendly approach and does not require you to notify the company before testing. 
+ In addition, it has a “Penetration Testing Rules of Engagement” page that spells out exactly what sort of penetration testing is permitted (https://www.microsoft.com/en-us/msrc/pentest-rules-of-engagement). 

As long as you stay up-to-date with the provider’s terms, you should be operating legally if you only test targets you are authorized to hack and avoid attacks that could cause an interruption to services.


## DoS Testing

I mentioned that DoS attacks are often off the table. 

Work with the client to understand their risk appetite for the given engagement. 

treat DOS testing as an opt-in service for clients who want to test the performance and reliability of their infrastructure.

Otherwise, work with the customer to see what they’re willing to allow.

Ultimately, whether a client accepts DoS testing as part of the scope depends on the organization’s risk [appetite](https://translate.google.com/?sl=en&tl=ar&text=appetite&op=translate), or the amount of risk an organization is willing to take on to achieve its purpose.

If an organization is cutting-edge and has a lot of confidence in its security, it may have a big appetite for risk.


## Reporting and [Remediation](https://translate.google.com/?sl=en&tl=ar&text=Remediation&op=translate) Testing

To your client, the most valuable aspect of your testing is the **report** you submit to communicate your findings about the effectiveness of their API security controls.

The report should spell out the vulnerabilities you discovered during your testing and explain to the client how they can perform remediation to improve the security of their APIs.



## A Note on Bug Bounty Scope

If you hope to hack professionally, a great way to get your foot in the door is to become a bug bounty hunter. 

Organizations like **`BugCrowd`** and **`HackerOne`** have created platforms that ==___make it easy for anyone to make an account and start hunting.___==

In addition, many organizations run their own bug bounty programs, including Google, Microsoft, Apple, Twitter, and GitHub. 

These programs include plenty of API bug bounties, many of which have additional incentives. 

For example, the **`Files.com`** bug bounty program hosted on `BugCrowd` includes API-specific bounties, as shown:
![[Pasted image 20241231071700.png]]

In bug bounty programs, you should pay attention to two contracts: 
+ the terms of service for the bug bounty provider and the scope of the program.
+ Violating either of these contracts could result not only in getting banned from the bug bounty provider but legal trouble as well.


## If you are new to bug hunting

introduction video and page dedicated to API security testing by Sadako (https://www.bugcrowd.com/resources/webinars/api-security-testing-for-hackers).

Also, check out Bug Bounty Bootcamp (No Starch Press, 2021)